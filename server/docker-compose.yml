services:
  firestore-emulator:
    build:
      context: .
      dockerfile: Dockerfile.firestore-emulator
    ports:
      - "8086:8086"
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8086/ || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 15
      start_period: 15s

  api:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - ENV=development
      - JWT_SECRET=dev-secret-docker
      - FIRESTORE_EMULATOR_HOST=firestore-emulator:8086
      - GOOGLE_CLOUD_PROJECT=local-sidekick-dev
    depends_on:
      firestore-emulator:
        condition: service_healthy
